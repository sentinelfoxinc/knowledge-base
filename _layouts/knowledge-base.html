<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en-US' }}">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    {% seo %}
    <link rel="stylesheet" href="{{ '/assets/css/knowledge-base.css?v=' | append: site.github.build_revision | relative_url }}">
    {% include head-custom.html %}
  </head>
  <body>
    <div class="kb-container">
      <!-- Sidebar -->
      <aside class="kb-sidebar">
        <div class="kb-sidebar-header">
          <div class="company-brand">
            <div class="company-logo">ü¶ä</div>
            <div class="company-info">
              <h2>SentinelFox</h2>
              <p class="company-tagline">Knowledge Base</p>
            </div>
          </div>
        </div>
        
        <nav class="kb-sidebar-nav">
          <ul class="kb-nav-main">
            <li>
              <a href="{{ '/' | relative_url }}" class="kb-nav-link {% if page.url == '/' %}active{% endif %}">
                <span class="nav-icon">üè†</span>
                <span class="nav-text">Home</span>
              </a>
            </li>
            <li>
              <a href="{{ '/aws' | relative_url }}" class="kb-nav-link {% if page.url contains '/aws' %}active{% endif %}">
                <span class="nav-icon">‚òÅÔ∏è</span>
                <span class="nav-text">AWS</span>
              </a>
            </li>
            <li>
              <a href="{{ '/terraform' | relative_url }}" class="kb-nav-link {% if page.url contains '/terraform' %}active{% endif %}">
                <span class="nav-icon">üõ†Ô∏è</span>
                <span class="nav-text">Terraform</span>
              </a>
            </li>
          </ul>
        </nav>

        <div class="kb-sidebar-footer">
          <div class="sidebar-company">
            <p class="company-name">SentinelFox Private Ltd</p>
            <p class="company-copyright">¬© 2024 All rights reserved</p>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="kb-main">
        <!-- Header with Breadcrumbs and Search -->
        <header class="kb-main-header">
          <div class="header-wrapper">
            <div class="header-content">
              <div class="breadcrumbs">
                <a href="{{ '/' | relative_url }}" class="breadcrumb-home">
                  <span class="breadcrumb-icon">üè†</span>
                  Home
                </a>
                {% if page.url != '/' %}
                  <span class="breadcrumb-separator">/</span>
                  <span class="breadcrumb-current">{{ page.title }}</span>
                {% endif %}
              </div>
              
              <div class="header-actions">
                <div class="search-container">
                  <input type="text" id="search-input" placeholder="Search knowledge base..." class="search-input">
                  <button class="search-btn">
                    <span class="search-icon">üîç</span>
                  </button>
                  <div id="search-results" class="search-results"></div>
                </div>
                
                {% if page.url != '/' %}
                <a href="javascript:history.back()" class="back-btn">
                  <span class="back-icon">‚Üê</span>
                  Back
                </a>
                {% endif %}
              </div>
            </div>
          </div>
        </header>

        <div class="kb-main-content">
          <!-- Content Card -->
          <div class="kb-content-card">
            <article class="kb-article">
              {{ content }}
            </article>

            <footer class="kb-footer">
              <div class="footer-content">
                <p class="copyright">¬© 2024 SentinelFox Private Ltd. All rights reserved.</p>
              </div>
            </footer>
          </div>
        </div>
      </main>
    </div>

    <!-- Search Data Storage -->
    <script type="application/json" id="search-data">
      [
        {% for page in site.pages %}
          {
            "title": "{{ page.title | escape }}",
            "url": "{{ page.url | relative_url }}",
            "content": {{ page.content | strip_html | strip_newlines | jsonify }}
          }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ]
    </script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Mobile menu functionality
      const mobileMenuBtn = document.createElement('button');
      mobileMenuBtn.className = 'kb-mobile-menu-btn';
      mobileMenuBtn.innerHTML = '‚ò∞ Menu';
      
      // Insert mobile menu button at the beginning of header actions
      const headerActions = document.querySelector('.header-actions');
      if (headerActions) {
        headerActions.insertBefore(mobileMenuBtn, headerActions.firstChild);
      }
      
      const sidebar = document.querySelector('.kb-sidebar');
      
      if (mobileMenuBtn && sidebar) {
        mobileMenuBtn.addEventListener('click', function() {
          sidebar.classList.toggle('mobile-open');
          document.body.classList.toggle('menu-open');
        });
      }
      
      // Close menu when clicking on links
      document.querySelectorAll('.kb-nav-link').forEach(link => {
        link.addEventListener('click', function() {
          if (sidebar) {
            sidebar.classList.remove('mobile-open');
            document.body.classList.remove('menu-open');
          }
        });
      });

      // Search functionality
      const searchInput = document.getElementById('search-input');
      const searchResults = document.getElementById('search-results');
      const searchDataElement = document.getElementById('search-data');
      
      if (searchInput && searchResults && searchDataElement) {
        const searchData = JSON.parse(searchDataElement.textContent);

        function performSearch(query) {
          if (query.length < 2) {
            searchResults.style.display = 'none';
            return;
          }

          const results = searchData.filter(item => {
            const searchText = (item.title + ' ' + item.content).toLowerCase();
            return searchText.includes(query.toLowerCase());
          });

          displayResults(results, query);
        }

        function displayResults(results, query) {
          if (results.length === 0) {
            searchResults.innerHTML = '<div class="search-no-results">No results found for "' + query + '"</div>';
            searchResults.style.display = 'block';
            return;
          }

          const resultsHtml = results.slice(0, 8).map(item => {
            const contentPreview = item.content.toLowerCase().indexOf(query.toLowerCase()) > -1 
              ? item.content.substring(0, 100) + '...' 
              : item.title;
            
            return `
              <a href="${item.url}" class="search-result-item">
                <div class="search-result-title">${highlightText(item.title, query)}</div>
                <div class="search-result-preview">${highlightText(contentPreview, query)}</div>
              </a>
            `;
          }).join('');

          searchResults.innerHTML = resultsHtml;
          searchResults.style.display = 'block';
        }

        function highlightText(text, query) {
          if (!query) return text;
          const regex = new RegExp(`(${query})`, 'gi');
          return text.replace(regex, '<mark>$1</mark>');
        }

        searchInput.addEventListener('input', function() {
          performSearch(this.value);
        });

        searchInput.addEventListener('focus', function() {
          if (this.value.length >= 2) {
            searchResults.style.display = 'block';
          }
        });

        // Close search results when clicking outside
        document.addEventListener('click', function(event) {
          if (!event.target.closest('.search-container')) {
            searchResults.style.display = 'none';
          }
        });

        // Keyboard navigation for search results
        searchInput.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') {
            searchResults.style.display = 'none';
            this.blur();
          }
        });
      }
    });
    </script>
  </body>
</html>